---
import MemberCard from './MemberCard.astro';
import { Image } from 'astro:assets';
import { members } from '../const/members';

const firstColumn = members.slice(0, 3);
const secondColumn = members.slice(3, 6);
const thirdColumn = members.slice(6, 9);
---

<section class="relative flex min-h-screen w-full p-2 pt-17 md:p-4 md:pt-20">
  <div class="relative flex w-full flex-col items-center text-center">
    <div class="absolute top-2/5 left-1/2 -translate-x-1/2 -translate-y-1/2">
      <div class="js-center-logo flex flex-col items-center">
        <Image
          class="animate-bounce"
          src="/images/logo.webp"
          alt="Twice"
          width={150}
          height={150}
        />
      </div>
    </div>
    <!-- Full Member Image -->
    <div
      class="pointer-events-none absolute inset-0 flex flex-col items-center"
    >
      <div
        class="mask-fade-bottom items center relative bottom-0 mx-auto flex h-[80vh] w-full justify-center"
      >
        {
          members.map(({ name }) => (
            <Image
              src={`/images/members/full/${name}-full.webp`}
              class="absolute hidden h-full w-auto object-cover lg:object-contain"
              alt={name}
              loading="lazy"
              decoding="async"
              width={200}
              height={300}
              fetchpriority="low"
              data-id={`full-image-${name}`}
            />
          ))
        }
      </div>
    </div>

    <!-- Member Selection Grid -->

    <div
      class="relative flex h-full w-full max-w-6xl flex-col items-center justify-end gap-8 sm:p-4"
    >
      <!-- Mobile: 3x3 grid layout -->
      <div
        id="member-grid"
        class="grid grid-cols-3 grid-rows-3 gap-1 xs:gap-2 sm:gap-4 w-full justify-items-center md:hidden"
      >
        {
          members.map(({ name, memberCardClasses }, index) => (
            <MemberCard
              id={name}
              extraClasses={`${memberCardClasses} animate-fade-in-up animate-delay-${(index + 1) * 100}`}
              src={`/images/members/cards/${name}.webp`}
              alt={name}
            />
          ))
        }
      </div>

      <!-- Desktop: original layout -->
      <div
        class="relative hidden md:grid md:min-w-0 md:grid-cols-3 md:grid-rows-2 md:gap-0"
      >
        <div>
          <div
            class="flex flex-row justify-around gap-2 md:justify-end lg:gap-4"
          >
            {
              firstColumn.map(({ name, memberCardClasses }, index) => (
                <MemberCard
                  id={name}
                  extraClasses={`${memberCardClasses} animate-fade-in-right animate-delay-${(index + 1) * 100}`}
                  src={`/images/members/cards/${name}.webp`}
                  alt={name}
                />
              ))
            }
          </div>
        </div>
        <div class="md:col-start-2 md:row-start-2">
          <div
            class="flex flex-row justify-around gap-2 md:justify-center lg:gap-4"
          >
            {
              secondColumn.map(({ name, memberCardClasses }, index) => (
                <MemberCard
                  id={name}
                  extraClasses={`${memberCardClasses} animate-fade-in-up animate-delay-${(index + 1) * 100}`}
                  src={`/images/members/cards/${name}.webp`}
                  alt={name}
                />
              ))
            }
          </div>
        </div>
        <div class="md:col-start-3 md:row-start-1">
          <div
            class="flex flex-row justify-around gap-2 md:justify-start lg:gap-4"
          >
            {
              thirdColumn.map(({ name, memberCardClasses }, index) => (
                <MemberCard
                  id={name}
                  extraClasses={`${memberCardClasses} animate-fade-in-left animate-delay-${(index + 1) * 100}`}
                  src={`/images/members/cards/${name}.webp`}
                  alt={name}
                />
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { $ } from '../utils/dom-selector';
  let currentMemberId: string | null = null;

  document.addEventListener('member-card-hover', (event: Event) => {
    const customEvent = event as CustomEvent<{ id: string }>;
    const id = customEvent.detail.id;
    const newMemberImage = $(`[data-id='full-image-${id}']`);
    const centeredLogo = $('.js-center-logo');

    if (currentMemberId === id) return;

    if (currentMemberId) {
      const currentMemberImage = $(`[data-id='full-image-${currentMemberId}']`);
      currentMemberImage?.classList.add('hidden');
    }

    newMemberImage?.classList.remove('animate-fade-out-down', 'hidden');
    newMemberImage?.classList.add('animate-fade-in-up');
    centeredLogo?.classList.add('hidden');

    currentMemberId = id;
  });

  document.addEventListener('member-card-exit', () => {
    if (currentMemberId) {
      const currentMemberImage = $(`[data-id='full-image-${currentMemberId}']`);
      const centeredLogo = $('.js-center-logo');

      currentMemberImage?.classList.add('animate-fade-out-down');
      centeredLogo?.classList.remove('hidden');

      currentMemberId = null;
    }
  });
</script>
